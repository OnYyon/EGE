# 13 задание
## Навигация
- [Сети и IP](#ip_net)
- [Двоичная запись](#bin-exmpl)
- [Способы перевода в двоичную запись](#how-to-bin)
- [Решение в python](#python-exmpl)
## <a id="ip_net"></a>Сети и IP-адреса
>Узел – это устройство, подключённое к сети. Например, компьютер, телефон, планшет. Каждый узел (устройство) в сети имеет свой IP-адрес.

>IP-адрес состоит из четырёх чисел, разделённых точками. Числа должны находиться в диапазоне от 0 до 255 включительно.

Примеры IP-адресов:
- 192.168.32.160
- 192.168.248.176
- 255.255.255.240

## <a id="bin-exmpl"></a> Двоичная запись
1. Переводим каждое число IP-адреса в двоичную систему счисления

- 3110 = 111112
- 13110 = 100000112
- 25010 = 111110102
- 1710 = 100012
2. Дописываем незначащие нули

Двоичная запись IP-адреса состоит из 32 нулей и единиц `********.********.********.********` (на месте звёздочек стоят двоичные цифры: 0 или 1). На каждое число IP-адреса (31, 131, 250, 17) отводится 1 байт – 8 бит, то есть восемь двоичных цифр.

- Первые восемь двоичных цифр – это двоичная запись первого числа. В нашем примере это 3110 = 111112. Но двоичная запись числа 31 состоит только из пяти цифр. Поэтому дописываем незначащие нули в начало двоичной записи, чтобы всего стало 8 цифр: 31 = 11111 = **000**11111.
- Вторые восемь двоичных цифр – это двоичная запись второго числа. В нашем примере это **131 = 10000011**.
- Третьи восемь двоичных цифр – это двоичная запись третьего числа. В нашем примере это **250 = 11111010**.
- Четвёртые восемь двоичных цифр – это двоичная запись четвёртого числа. В нашем примере это **17 = 100012 = 00010001**.

Получаем, что двоичная запись IP-адреса 31.131.250.17 равна `00011111.10000011.11111010.00010001`.

## <a id="how-to-bin"></a>Способы перевода в двоичную запись
```python 
print(bin(31)[2:] + '.' + bin(131)[2:] + '.' + bin(250)[2:] + '.' + bin(17)[2:])
# 11111.10000011.11111010.10001
```
```python
print(bin(31)[2:].zfill(8) + '.' + bin(131)[2:].zfill(8) + '.' + bin(250)[2:].zfill(8) + '.' + bin(17)[2:].zfill(8))
# 00011111.10000011.11111010.00010001
```
```python
print(f'{int(31):08b}') # 00011111
```
```python
print(".".join(f"{int(bin(i)[2:]):08}" for i in map(int, "192.168.248.176".split("."))))
```
## <a id="netmask"></a>Адрес сети, номер узла и маска сети
Как нам понять, какая часть IP-адреса относится к адресу сети, а какая к номеру узла?

Для этого у каждой сети есть маска. Она и определяет, какая часть IP-адреса относится к адресу сети, а какая к номеру узла.
>Маска всегда состоит из идущих подряд единиц, а следом за ними идущих подряд нулей. То есть в двоичной записи маски сначала идут единицы, а после них нули: 111...000.
>>Биты, в которых в маске стоят единицы, относятся к адресу сети.
> 
>>Биты, в которых в маске стоят нули, относятся к номеру хоста.

Пусть у нас есть компьютер и планшет, подключенные к одной сети. IP-адрес компьютера в этой сети равен 118.222.130.140, а IP-адрес планшета – 118.222.201.140. Маска этой сети равна 255.255.128.0.

Запишем IP-адреса и маску в двоичном представлении.
```
IP-адрес компьютера: 01110110.11011110.10000010.10001100
IP-адрес планшета:   01110110.11011110.11001001.10001100
Маска сети:          11111111.11111111.10000000.00000000
```
Единицы в маске стоят в первых семнадцати битах – значит часть IP-адреса, относящаяся к адресу сети состоит из первых семнадцати бит. В нашем примере это 01110110.11011110.1. Значит IP-адрес этой сети равен 01110110.11011110.100000000.00000000, так как у IP-адреса сети в номере узла должны стоять одни нули.

Нули в маске стоят в последних пятнадцати битах – значит часть IP-адреса, относящаяся к номеру узла состоит из последних пятнадцати бит. В нашем примере номер узла компьютера это 0000010.10001100, а номер узла планшета 1001001.10001100.
## <a id="python-exmpl"></a> Решение в python
В Python 3.3 появился модуль `ipaddress`. С помощью него можно решать № 13 ЕГЭ.
Для решения № 13 нам потребуются функции `ip_address()` и `ip_network()`.
### Создание IP-адреса
С помощью функции ip_address() можно создать объект – IP-адрес. В качестве аргумента функции мы указываем строку, в которой записано значение IP-адреса.

```python
import ipaddress as ipaddr

ip = ipaddr.ip_address('192.168.0.1')
print(ip, type(ip))
```
Программа выводит
```pycon
192.168.0.1 <class 'ipaddress.IPv4Address'>
```
Обратите внимание, что функция ip_address() возвращает не просто строку, а объект ipaddress.IPv4Address.

### Как переводить в двоичную запись(<class 'ipaddress.IPv4Address'>)
Вообще работает `int()`. Она просто переводит в десятичное представление весь `ip`, т.е превращает в одно десятичное число.
Что под капотом у `int()`? `192.168.0.1` -> `11000000.10101000.00000000.00000001` -> `11000000101010000000000000000001` ->`int("11000000101010000000000000000001", 2)`

Например:
```python
import ipaddress as ipaddr

ip = ipaddr.ip_address("192.168.0.1")
print(int(ip)) # -> 3232235521
```
Дальше просто переводим в двоичную СИС и добавляем незначащие нули.

Полный код
```python
import ipaddress as ipaddr

ip = ipaddr.ip_address("192.168.0.1")
print(bin(int(ip))[2:].zfill(32)) # -> 11000000101010000000000000000001
```
Можно через `format-string`
```python
import ipaddress as ipaddr

ip = ipaddr.ip_address("192.168.0.1")
print(f"{ip:b}")
```

### Создание сети
С помощью функции `ip_network()` можно создать объект сети. Так как каждая сеть задаётся IP-адресом и маской сети, то в качестве аргумента функции мы указываем строку, содержащую IP-адрес сети и маску разделённые /.
```python
from ipaddress import *

net = ip_network('192.168.32.160/255.255.255.240')
```
Через `/` пишем маску сети

Так же маску можно задать по `количеству 1 в двоичной записи`.

Наример:
- 255.255.255.240 -> 28
- 255.255.255.128 -> 25
- 255.255.255.192 -> 26

### Примечание
Адрес сети, содержащий единицы в номере хоста.

```python
from ipaddress import *

net = ip_network('192.168.32.160/255.255.255.192')
```
Программа аварийно завершается с ошибкой: ValueError: 192.168.32.160/26 has host bits set.

При маске 255.255.255.192 в последних шести битах адреса сети должны стоять нули, так как они относятся к номеру хоста.

<p align="center">IP-адрес сети: 11000000101010000010000010100000</p>
<p align="center">Маска: 11111111111111111111111111000000</p>

## Небольшой шаблон для типа 13
>(Демо 2016) В терминологии сетей TCP/IP маской сети называется двоичное число, определяющее, какая часть IP-адреса узла сети относится к адресу сети, а какая – к адресу самого узла в этой сети. Обычно маска записывается по тем же правилам, что и IP-адрес, – в виде четырёх байтов, причём каждый байт записывается в виде десятичного числа. При этом в маске сначала (в старших разрядах) стоят единицы, а затем с некоторого разряда – нули. Адрес сети получается в результате применения поразрядной конъюнкции к заданному IP-адресу узла и маске.
>
>Например, если IP-адрес узла равен 231.32.255.131, а маска равна 255.255.240.0, то адрес сети равен 231.32.240.0.
>
>Для узла с IP-адресом 111.81.208.27 адрес сети равен 111.81.192.0.
>
>Чему равно наименьшее возможное значение третьего слева байта маски? Ответ запишите в виде десятичного числа.
```python
from ipaddress import *

for i in range(0, 33):
    try:
        net = ip_network('111.81.192.0/' + str(i))
        if ip_address('111.81.208.27') in net:
            print(i)
    except:
        pass
```
